{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/ATIDA2025/community-lending-platform/lib/dbConnect.ts"],"sourcesContent":["import mongoose from 'mongoose';\r\n\r\nconst MONGODB_URI = process.env.MONGODB_URI;\r\n\r\nif (!MONGODB_URI) {\r\n  throw new Error(\r\n    'Please define the MONGODB_URI environment variable inside .env.local'\r\n  );\r\n}\r\n\r\n/**\r\n * Global is used here to maintain a cached connection across hot reloads\r\n * in development. This prevents connections from growing exponentially\r\n * during API Route usage.\r\n */\r\nlet cached = (global as any).mongoose;\r\n\r\nif (!cached) {\r\n  cached = (global as any).mongoose = { conn: null, promise: null };\r\n}\r\n\r\nasync function dbConnect() {\r\n  if (cached.conn) {\r\n    return cached.conn;\r\n  }\r\n\r\n  if (!cached.promise) {\r\n    const opts = {\r\n      bufferCommands: false,\r\n    };\r\n\r\n    cached.promise = mongoose.connect(MONGODB_URI!, opts).then((mongoose) => {\r\n      return mongoose;\r\n    });\r\n  }\r\n  \r\n  try {\r\n    cached.conn = await cached.promise;\r\n  } catch (e) {\r\n    cached.promise = null;\r\n    throw e;\r\n  }\r\n\r\n  return cached.conn;\r\n}\r\n\r\nexport default dbConnect;\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,cAAc,QAAQ,GAAG,CAAC,WAAW;AAE3C,IAAI,CAAC,aAAa;IAChB,MAAM,IAAI,MACR;AAEJ;AAEA;;;;CAIC,GACD,IAAI,SAAS,yDAAgB,QAAQ;AAErC,IAAI,CAAC,QAAQ;IACX,SAAS,yDAAgB,QAAQ,GAAG;QAAE,MAAM;QAAM,SAAS;IAAK;AAClE;AAEA,eAAe;IACb,IAAI,OAAO,IAAI,EAAE;QACf,OAAO,OAAO,IAAI;IACpB;IAEA,IAAI,CAAC,OAAO,OAAO,EAAE;QACnB,MAAM,OAAO;YACX,gBAAgB;QAClB;QAEA,OAAO,OAAO,GAAG,oHAAQ,CAAC,OAAO,CAAC,aAAc,MAAM,IAAI,CAAC,CAAC;YAC1D,OAAO;QACT;IACF;IAEA,IAAI;QACF,OAAO,IAAI,GAAG,MAAM,OAAO,OAAO;IACpC,EAAE,OAAO,GAAG;QACV,OAAO,OAAO,GAAG;QACjB,MAAM;IACR;IAEA,OAAO,OAAO,IAAI;AACpB;uCAEe","debugId":null}},
    {"offset": {"line": 92, "column": 0}, "map": {"version":3,"sources":["file:///C:/ATIDA2025/community-lending-platform/models/item.model.ts"],"sourcesContent":["import { Schema, model, models, Document, Model, Types } from 'mongoose';\r\nimport { IItem, IDamageLog } from '../types';\r\n\r\nconst DamageLogSchema = new Schema<IDamageLog>({\r\n    date: { type: Date, required: true },\r\n    description: { type: String, required: true },\r\n    reportedBy: { type: String, required: true }, // Should be a user name\r\n});\r\n\r\nconst ItemSchema = new Schema<IItem>({\r\n  name: {\r\n    type: String,\r\n    required: [true, 'Please provide an item name.'],\r\n    trim: true,\r\n  },\r\n  category: {\r\n    type: String,\r\n    required: [true, 'Please provide a category.'],\r\n    trim: true,\r\n    index: true,\r\n  },\r\n  inventoryCount: {\r\n    type: Number,\r\n    required: [true, 'Please provide the inventory count.'],\r\n    min: [0, 'Inventory count cannot be negative.'],\r\n  },\r\n  imageUrl: {\r\n    type: String,\r\n    required: [true, 'Please provide an image URL.'],\r\n  },\r\n  damageLog: [DamageLogSchema],\r\n}, {\r\n  timestamps: true,\r\n  toJSON: { virtuals: true },\r\n  toObject: { virtuals: true }\r\n});\r\n\r\n// Fix: Explicitly cast `this._id` to `Types.ObjectId` to resolve `toHexString` error.\r\nItemSchema.virtual('id').get(function(){\r\n    return (this._id as Types.ObjectId).toHexString();\r\n});\r\n\r\n\r\n// Fix: Correctly type the exported model to prevent query method errors\r\nexport default (models.Item as Model<IItem>) || model<IItem>('Item', ItemSchema);"],"names":[],"mappings":";;;;AAAA;;AAGA,MAAM,kBAAkB,IAAI,mHAAM,CAAa;IAC3C,MAAM;QAAE,MAAM;QAAM,UAAU;IAAK;IACnC,aAAa;QAAE,MAAM;QAAQ,UAAU;IAAK;IAC5C,YAAY;QAAE,MAAM;QAAQ,UAAU;IAAK;AAC/C;AAEA,MAAM,aAAa,IAAI,mHAAM,CAAQ;IACnC,MAAM;QACJ,MAAM;QACN,UAAU;YAAC;YAAM;SAA+B;QAChD,MAAM;IACR;IACA,UAAU;QACR,MAAM;QACN,UAAU;YAAC;YAAM;SAA6B;QAC9C,MAAM;QACN,OAAO;IACT;IACA,gBAAgB;QACd,MAAM;QACN,UAAU;YAAC;YAAM;SAAsC;QACvD,KAAK;YAAC;YAAG;SAAsC;IACjD;IACA,UAAU;QACR,MAAM;QACN,UAAU;YAAC;YAAM;SAA+B;IAClD;IACA,WAAW;QAAC;KAAgB;AAC9B,GAAG;IACD,YAAY;IACZ,QAAQ;QAAE,UAAU;IAAK;IACzB,UAAU;QAAE,UAAU;IAAK;AAC7B;AAEA,sFAAsF;AACtF,WAAW,OAAO,CAAC,MAAM,GAAG,CAAC;IACzB,OAAO,AAAC,IAAI,CAAC,GAAG,CAAoB,WAAW;AACnD;uCAIe,AAAC,mHAAM,CAAC,IAAI,IAAqB,IAAA,kHAAK,EAAQ,QAAQ","debugId":null}},
    {"offset": {"line": 235, "column": 0}, "map": {"version":3,"sources":["file:///C:/ATIDA2025/community-lending-platform/types.ts"],"sourcesContent":["import { Document, Types } from 'mongoose';\r\n// Fix: Add imports for next-auth module augmentation\r\nimport 'next-auth';\r\nimport 'next-auth/jwt';\r\n\r\nexport enum Role {\r\n  USER = 'user',\r\n  ADMIN = 'admin',\r\n}\r\n\r\nexport enum OrderStatus {\r\n  PENDING = 'Pending',\r\n  ACTIVE = 'Active',\r\n  RETURNED = 'Returned',\r\n  CANCELLED = 'Cancelled',\r\n}\r\n\r\n// The primary User interface for the application\r\nexport interface User {\r\n  id: string;\r\n  email: string;\r\n  name: string;\r\n  phone: string;\r\n  role: Role;\r\n}\r\n\r\nexport interface DamageLog {\r\n  _id?: string;\r\n  date: string; // Using string for serialization\r\n  description: string;\r\n  reportedBy: string;\r\n}\r\n\r\nexport interface Item {\r\n  id:string;\r\n  name: string;\r\n  category: string;\r\n  inventoryCount: number;\r\n  imageUrl: string;\r\n  damageLog: DamageLog[];\r\n}\r\n\r\nexport interface Order {\r\n  id: string;\r\n  userId: string | User; // Can be populated\r\n  itemId: string | Item; // Can be populated\r\n  pickupDate: string; // Using string for serialization\r\n  returnDate: string; // Using string for serialization\r\n  status: OrderStatus;\r\n  createdAt: string; // Using string for serialization\r\n}\r\n\r\n// Mongoose Document interfaces\r\nexport interface IUser extends Document {\r\n  email: string;\r\n  name: string;\r\n  phone: string;\r\n  role: Role;\r\n  hashedPassword?: string;\r\n}\r\n\r\nexport interface IDamageLog extends Document {\r\n    date: Date;\r\n    description: string;\r\n    reportedBy: string;\r\n}\r\n\r\nexport interface IItem extends Document {\r\n  id: string; // virtual getter\r\n  name: string;\r\n  category: string;\r\n  inventoryCount: number;\r\n  imageUrl: string;\r\n  damageLog: IDamageLog[];\r\n}\r\n\r\nexport interface IOrder extends Document {\r\n  id: string; // virtual getter\r\n  userId: Types.ObjectId;\r\n  itemId: Types.ObjectId;\r\n  pickupDate: Date;\r\n  returnDate: Date;\r\n  status: OrderStatus;\r\n}\r\n\r\n// Fix: Add module augmentation for next-auth to include custom session properties.\r\ndeclare module 'next-auth' {\r\n  interface Session {\r\n    user: {\r\n      id: string;\r\n      role: Role;\r\n    } & DefaultSession['user'];\r\n  }\r\n\r\n  interface User {\r\n    role: Role;\r\n  }\r\n}\r\n\r\ndeclare module 'next-auth/jwt' {\r\n  interface JWT {\r\n    id: string;\r\n    role: Role;\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;AACA,qDAAqD;AACrD;AACA;;;AAEO,IAAA,AAAK,8BAAA;;;WAAA;;AAKL,IAAA,AAAK,qCAAA;;;;;WAAA","debugId":null}},
    {"offset": {"line": 262, "column": 0}, "map": {"version":3,"sources":["file:///C:/ATIDA2025/community-lending-platform/lib/authUtils.ts"],"sourcesContent":["import { User } from '../types';\r\n\r\n// This is a simplified \"JWT\" decoder for our base64-encoded token.\r\n// In a production app, you would use a library like 'jose' or 'jsonwebtoken' to verify a real JWT signature.\r\nfunction decodeToken(token: string): User | null {\r\n    try {\r\n        const payload = JSON.parse(atob(token));\r\n        // Basic validation\r\n        if (payload && payload.id && payload.role && payload.name) {\r\n            return payload as User;\r\n        }\r\n        return null;\r\n    } catch (error) {\r\n        console.error(\"Token decoding failed:\", error);\r\n        return null;\r\n    }\r\n}\r\n\r\n\r\nexport function getAuthenticatedUser(req: Request): User | null {\r\n    try {\r\n        const authHeader = req.headers.get('Authorization');\r\n        if (!authHeader || !authHeader.startsWith('Bearer ')) {\r\n            return null;\r\n        }\r\n        const token = authHeader.split(' ')[1];\r\n        if (!token) {\r\n            return null;\r\n        }\r\n        return decodeToken(token);\r\n    } catch (error) {\r\n        return null;\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;AAEA,mEAAmE;AACnE,6GAA6G;AAC7G,SAAS,YAAY,KAAa;IAC9B,IAAI;QACA,MAAM,UAAU,KAAK,KAAK,CAAC,KAAK;QAChC,mBAAmB;QACnB,IAAI,WAAW,QAAQ,EAAE,IAAI,QAAQ,IAAI,IAAI,QAAQ,IAAI,EAAE;YACvD,OAAO;QACX;QACA,OAAO;IACX,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,0BAA0B;QACxC,OAAO;IACX;AACJ;AAGO,SAAS,qBAAqB,GAAY;IAC7C,IAAI;QACA,MAAM,aAAa,IAAI,OAAO,CAAC,GAAG,CAAC;QACnC,IAAI,CAAC,cAAc,CAAC,WAAW,UAAU,CAAC,YAAY;YAClD,OAAO;QACX;QACA,MAAM,QAAQ,WAAW,KAAK,CAAC,IAAI,CAAC,EAAE;QACtC,IAAI,CAAC,OAAO;YACR,OAAO;QACX;QACA,OAAO,YAAY;IACvB,EAAE,OAAO,OAAO;QACZ,OAAO;IACX;AACJ","debugId":null}},
    {"offset": {"line": 300, "column": 0}, "map": {"version":3,"sources":["file:///C:/ATIDA2025/community-lending-platform/app/api/items/route.ts"],"sourcesContent":["import dbConnect from '../../../lib/dbConnect';\r\nimport Item from '../../../models/item.model';\r\nimport { Role } from '../../../types';\r\nimport { getAuthenticatedUser } from '../../../lib/authUtils';\r\n\r\n// GET all items (publicly accessible)\r\nexport async function GET(req: Request) {\r\n  try {\r\n    await dbConnect();\r\n    const items = await Item.find({}).sort({ createdAt: -1 });\r\n    return new Response(JSON.stringify(items), {\r\n      status: 200,\r\n      headers: { 'Content-Type': 'application/json' },\r\n    });\r\n  } catch (error) {\r\n    return new Response(JSON.stringify({ error: 'Server error' }), {\r\n      status: 500,\r\n      headers: { 'Content-Type': 'application/json' },\r\n    });\r\n  }\r\n}\r\n\r\n// POST a new item (Admin only)\r\nexport async function POST(req: Request) {\r\n  const user = getAuthenticatedUser(req);\r\n  if (!user || user.role !== Role.ADMIN) {\r\n    return new Response(JSON.stringify({ error: 'Unauthorized' }), {\r\n      status: 401,\r\n      headers: { 'Content-Type': 'application/json' },\r\n    });\r\n  }\r\n\r\n  try {\r\n    await dbConnect();\r\n    const body = await req.json();\r\n    const newItem = await Item.create(body);\r\n    return new Response(JSON.stringify(newItem), {\r\n      status: 201,\r\n      headers: { 'Content-Type': 'application/json' },\r\n    });\r\n  } catch (error: any) {\r\n    return new Response(JSON.stringify({ error: error.message }), {\r\n      status: 400,\r\n      headers: { 'Content-Type': 'application/json' },\r\n    });\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;AACA;;;;;AAGO,eAAe,IAAI,GAAY;IACpC,IAAI;QACF,MAAM,IAAA,6HAAS;QACf,MAAM,QAAQ,MAAM,oIAAI,CAAC,IAAI,CAAC,CAAC,GAAG,IAAI,CAAC;YAAE,WAAW,CAAC;QAAE;QACvD,OAAO,IAAI,SAAS,KAAK,SAAS,CAAC,QAAQ;YACzC,QAAQ;YACR,SAAS;gBAAE,gBAAgB;YAAmB;QAChD;IACF,EAAE,OAAO,OAAO;QACd,OAAO,IAAI,SAAS,KAAK,SAAS,CAAC;YAAE,OAAO;QAAe,IAAI;YAC7D,QAAQ;YACR,SAAS;gBAAE,gBAAgB;YAAmB;QAChD;IACF;AACF;AAGO,eAAe,KAAK,GAAY;IACrC,MAAM,OAAO,IAAA,0IAAoB,EAAC;IAClC,IAAI,CAAC,QAAQ,KAAK,IAAI,KAAK,+GAAI,CAAC,KAAK,EAAE;QACrC,OAAO,IAAI,SAAS,KAAK,SAAS,CAAC;YAAE,OAAO;QAAe,IAAI;YAC7D,QAAQ;YACR,SAAS;gBAAE,gBAAgB;YAAmB;QAChD;IACF;IAEA,IAAI;QACF,MAAM,IAAA,6HAAS;QACf,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,MAAM,UAAU,MAAM,oIAAI,CAAC,MAAM,CAAC;QAClC,OAAO,IAAI,SAAS,KAAK,SAAS,CAAC,UAAU;YAC3C,QAAQ;YACR,SAAS;gBAAE,gBAAgB;YAAmB;QAChD;IACF,EAAE,OAAO,OAAY;QACnB,OAAO,IAAI,SAAS,KAAK,SAAS,CAAC;YAAE,OAAO,MAAM,OAAO;QAAC,IAAI;YAC5D,QAAQ;YACR,SAAS;gBAAE,gBAAgB;YAAmB;QAChD;IACF;AACF","debugId":null}}]
}